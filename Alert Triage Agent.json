{
  "name": "Alert Triage Agent",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        0,
        0
      ],
      "id": "9dcffcf4-3555-4f78-bb5c-2d7ad37118ae",
      "name": "When chat message received",
      "webhookId": "ebbcb9a4-fbf9-4870-ad41-64a47c50c8a0"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=You are an Al agent that queries the Wazuh index server to retrieve alerts and triage the alerts for the user. Use the\nHTTP tool to query alerts and the Gemini tool to generate summaries.\n\nWhen retrieving alerts, apply this severity mapping based on the Wazuh rule.level field:\n\n. 0 to 3: Low\n. 4 to 7: Medium\n. 8 to 10: High\n\nYou are responsible for triaging alerts from the EDR system, helping classify them based on their severity\nand relevance. Your goal is to prioritize alerts that need investigation while filtering out noise. Follow\nthese guidelines:\n\n1. Classify Alerts by Severity:\n. High Severity: Likely attacks or active threats (e.g., malware, privilege escalation, exploit\nattempts).\n. Medium Severity: Suspicious activity or potential vulnerabilities needing review.\n. Low Severity: Routine behavior or non-critical issues, often noise.\n2. Key Indicators for Escalation:\n. Malware or Exploits: Any potential active threats.\n. Privilege Escalation: Unauthorized changes in user permissions.\n. Suspicious Behavior: Unusual processes or network activity.\n3. Noise Detection:\n. Known benign activity (e.g., software updates, common system processes) can generally be\nconsidered low severity.\n. Frequent alerts from the same source may indicate misconfigurations or false positives.\n4. Context Matters:\n. Always consider user, time, and location-anomalies in these areas are often higher priority.\nYour goal is to filter out noise, highlight risks, and classify alerts efficiently for further analysis.\n\n\n",
          "passthroughBinaryImages": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        176,
        0
      ],
      "id": "2ecb49b4-ab13-41a6-b6d3-22d03e907a01",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -16,
        224
      ],
      "id": "1cb8ae8f-0cbc-42c7-b42e-8bb14a598ab8",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "vn8R6UJfMzPTmEiA",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        160,
        224
      ],
      "id": "4f6fd629-8627-422e-87a8-4f8e38281602",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://single-node-wazuh.indexer-1:9200/wazuh-alerts-4.x-*/_search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={\n  \"size\": 0,\n  \"query\": {\n    \"bool\": {\n      \"filter\": [\n        {\n          \"range\": {\n            \"@timestamp\": {\n              \"gte\": \"{{ $fromAI('start_time', 'Start time for search (e.g. now-24h)', 'string', 'now-24h') }}\",\n              \"lt\": \"{{ $fromAI('end_time', 'End time for search (e.g. now)', 'string', 'now') }}\",\n              \"time_zone\": \"America/Denver\"\n            }\n          }\n        },\n        {\n          \"range\": {\n            \"rule.level\": {\n              \"gte\": {{ $fromAI('min_severity', 'Minimum rule level (0-15)', 'number', 0) }},\n              \"lte\": {{ $fromAI('max_severity', 'Maximum rule level (0-15)', 'number', 15) }}\n            }\n          }\n        }\n      ],\n      \"must_not\": [\n        {\n          \"bool\": {\n            \"should\": [\n              { \"exists\": { \"field\": \"data.vulnerability.cve\" } }\n            ]\n          }\n        }\n      ]\n    }\n  },\n  \"aggs\": {\n    \"by_endpoint\": {\n      \"terms\": {\n        \"field\": \"agent.name\",\n        \"size\": 50,\n        \"order\": { \"_count\": \"desc\" }\n      },\n      \"aggs\": {\n        \"by_finding_title\": {\n          \"terms\": {\n            \"field\": \"rule.description\",\n            \"size\": 50,\n            \"order\": { \"_count\": \"desc\" }\n          },\n          \"aggs\": {\n            \"by_command\": {\n              \"terms\": {\n                \"field\": \"data.command\",\n                \"size\": 50,\n                \"order\": { \"_count\": \"desc\" }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n",
        "options": {
          "allowUnauthorizedCerts": true
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        544,
        176
      ],
      "id": "26b6779c-113d-4403-844e-155fc55b49c2",
      "name": "HTTP Request",
      "credentials": {
        "httpBasicAuth": {
          "id": "ltRJx0ZrRopNnKLc",
          "name": "Wazuh Indexer cred"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Prompt', ``, 'string') }}"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGeminiTool",
      "typeVersion": 1.1,
      "position": [
        384,
        208
      ],
      "id": "9f5eb93e-a743-4dbb-890e-596713093ca7",
      "name": "Message a model in Google Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "vn8R6UJfMzPTmEiA",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Message a model in Google Gemini": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "482bc0cd-cfe2-4d4d-b204-2aaeffb53200",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "601736b3e5947351f90f90a186f32dccd2a7593e661438f774c24a8869bd5fc5"
  },
  "id": "ugFGeXLDAaP1lVXj",
  "tags": []
}